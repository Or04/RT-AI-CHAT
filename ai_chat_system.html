<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chat System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .chat-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 800px;
            height: 600px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .chat-header {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .chat-header h1 {
            font-size: 24px;
            font-weight: 600;
        }

        .status-indicator {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #4CAF50;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 14px;
        }

        .message.user .message-avatar {
            background: linear-gradient(45deg, #2196F3, #1976D2);
        }

        .message.ai .message-avatar {
            background: linear-gradient(45deg, #FF9800, #F57C00);
        }

        .message-content {
            background: white;
            padding: 12px 16px;
            border-radius: 18px;
            max-width: 70%;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .message.user .message-content {
            background: linear-gradient(45deg, #2196F3, #1976D2);
            color: white;
        }

        .message-time {
            font-size: 11px;
            color: #666;
            margin-top: 4px;
        }

        .message.user .message-time {
            color: rgba(255, 255, 255, 0.8);
        }

        .typing-indicator {
            display: none;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            background: white;
            border-radius: 18px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            max-width: 80px;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #999;
            animation: typing 1.5s infinite ease-in-out;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }

        .chat-input-container {
            padding: 20px;
            background: white;
            border-top: 1px solid #eee;
        }

        .chat-input-wrapper {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        .chat-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 14px;
            outline: none;
            resize: none;
            min-height: 44px;
            max-height: 120px;
            font-family: inherit;
            transition: border-color 0.3s ease;
        }

        .chat-input:focus {
            border-color: #4CAF50;
        }

        .send-button {
            width: 44px;
            height: 44px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            font-size: 16px;
        }

        .send-button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.4);
        }

        .send-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .job-status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            font-size: 12px;
            color: #666;
            backdrop-filter: blur(10px);
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .job-status.show {
            transform: translateX(0);
        }

        .welcome-message {
            text-align: center;
            color: #666;
            padding: 40px 20px;
            font-style: italic;
        }

        /* Scrollbar styling */
        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 10px;
        }

        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            .chat-container {
                height: 100vh;
                border-radius: 0;
                margin: 0;
            }
            
            .message-content {
                max-width: 85%;
            }
            
            .job-status {
                position: static;
                margin-bottom: 10px;
                transform: none;
                width: fit-content;
                margin-left: auto;
                margin-right: auto;
            }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <h1>ðŸ¤– AI Assistant Chat</h1>
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span id="connectionStatus">Online</span>
            </div>
        </div>
        
        <div class="chat-messages" id="chatMessages">
            <div class="welcome-message">
                ðŸ‘‹ Welcome! Start a conversation with your AI assistant.
            </div>
        </div>
        
        <div class="chat-input-container">
            <div class="chat-input-wrapper">
                <textarea 
                    id="messageInput" 
                    class="chat-input" 
                    placeholder="Type your message here..." 
                    rows="1"
                ></textarea>
                <button id="sendButton" class="send-button">
                    âž¤
                </button>
            </div>
        </div>
    </div>

    <div id="jobStatus" class="job-status">
        Processing...
    </div>

    <script>
        class AIChat {
            constructor() {
                this.messages = [];
                this.isProcessing = false;
                this.jobQueue = [];
                this.init();
            }

            init() {
                this.bindEvents();
                this.setupAutoResize();
                this.simulateWebSocket();
            }

            bindEvents() {
                const input = document.getElementById('messageInput');
                const sendButton = document.getElementById('sendButton');

                sendButton.addEventListener('click', () => this.sendMessage());
                
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.sendMessage();
                    }
                });

                input.addEventListener('input', () => {
                    sendButton.disabled = !input.value.trim();
                });
            }

            setupAutoResize() {
                const input = document.getElementById('messageInput');
                input.addEventListener('input', () => {
                    input.style.height = 'auto';
                    input.style.height = Math.min(input.scrollHeight, 120) + 'px';
                });
            }

            simulateWebSocket() {
                // Simulate WebSocket connection status
                setInterval(() => {
                    const status = document.getElementById('connectionStatus');
                    const dot = document.querySelector('.status-dot');
                    
                    if (Math.random() > 0.95) {
                        status.textContent = 'Reconnecting...';
                        dot.style.background = '#FF9800';
                        
                        setTimeout(() => {
                            status.textContent = 'Online';
                            dot.style.background = '#4CAF50';
                        }, 1000);
                    }
                }, 5000);
            }

            async sendMessage() {
                const input = document.getElementById('messageInput');
                const message = input.value.trim();
                
                if (!message || this.isProcessing) return;

                // Add user message
                this.addMessage(message, 'user');
                input.value = '';
                input.style.height = 'auto';
                
                // Create job for processing
                const jobId = await this.createJob(message);
                this.showJobStatus(`Processing job ${jobId}...`);
                
                // Show typing indicator
                this.showTypingIndicator();
                
                // Poll job status
                this.pollJobStatus(jobId);
            }

            async createJob(message) {
                // Simulate API call to create job
                const response = await this.simulateAPI('/api/jobs', 'POST', {
                    message: message,
                    type: 'chat',
                    timestamp: new Date().toISOString()
                });
                
                return response.jobId;
            }

            async pollJobStatus(jobId) {
                this.isProcessing = true;
                
                const poll = async () => {
                    try {
                        const response = await this.simulateAPI(`/api/jobs/${jobId}`, 'GET');
                        
                        this.showJobStatus(`Job ${jobId}: ${response.status}`);
                        
                        if (response.status === 'completed') {
                            this.hideTypingIndicator();
                            this.addMessage(response.result, 'ai');
                            this.hideJobStatus();
                            this.isProcessing = false;
                        } else if (response.status === 'failed') {
                            this.hideTypingIndicator();
                            this.addMessage('Sorry, I encountered an error processing your message. Please try again.', 'ai');
                            this.hideJobStatus();
                            this.isProcessing = false;
                        } else {
                            // Continue polling
                            setTimeout(poll, 1000);
                        }
                    } catch (error) {
                        console.error('Polling error:', error);
                        this.hideTypingIndicator();
                        this.addMessage('Connection error. Please try again.', 'ai');
                        this.hideJobStatus();
                        this.isProcessing = false;
                    }
                };
                
                poll();
            }

            async simulateAPI(endpoint, method, data = null) {
                // Simulate API latency
                await new Promise(resolve => setTimeout(resolve, 300 + Math.random() * 700));
                
                if (endpoint.includes('/api/jobs/') && method === 'GET') {
                    const jobId = endpoint.split('/').pop();
                    
                    // Simulate job processing states
                    if (!this.jobStates) this.jobStates = {};
                    if (!this.jobStates[jobId]) {
                        this.jobStates[jobId] = { status: 'processing', startTime: Date.now() };
                    }
                    
                    const job = this.jobStates[jobId];
                    const elapsed = Date.now() - job.startTime;
                    
                    if (elapsed < 2000) {
                        return { jobId, status: 'processing' };
                    } else if (elapsed < 4000) {
                        return { jobId, status: 'analyzing' };
                    } else {
                        // Generate AI response
                        const responses = [
                            "I understand your question! Let me help you with that. Based on what you've shared, here's my perspective...",
                            "That's an interesting point! I think the key considerations here are efficiency, user experience, and scalability.",
                            "Great question! In my analysis, I'd recommend focusing on the core functionality first, then iterating based on user feedback.",
                            "I appreciate you sharing that with me. From an AI perspective, I see several approaches we could take...",
                            "Thanks for the detailed question! Let me break this down into manageable components for you.",
                            "That's a complex topic! I'd suggest starting with a proof of concept to validate the core assumptions.",
                            "Excellent observation! The trade-offs you're considering are exactly the right ones to think about.",
                            "I can definitely help with that! Based on current best practices, here's what I'd recommend..."
                        ];
                        
                        return {
                            jobId,
                            status: 'completed',
                            result: responses[Math.floor(Math.random() * responses.length)]
                        };
                    }
                }
                
                if (endpoint === '/api/jobs' && method === 'POST') {
                    return {
                        jobId: 'job_' + Math.random().toString(36).substr(2, 9),
                        status: 'created',
                        message: 'Job created successfully'
                    };
                }
                
                throw new Error('Unknown endpoint');
            }

            addMessage(content, sender) {
                const messagesContainer = document.getElementById('chatMessages');
                const welcomeMessage = messagesContainer.querySelector('.welcome-message');
                
                if (welcomeMessage) {
                    welcomeMessage.remove();
                }
                
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${sender}`;
                
                const avatar = document.createElement('div');
                avatar.className = 'message-avatar';
                avatar.textContent = sender === 'user' ? 'U' : 'AI';
                
                const messageContent = document.createElement('div');
                messageContent.className = 'message-content';
                
                const messageText = document.createElement('div');
                messageText.textContent = content;
                
                const messageTime = document.createElement('div');
                messageTime.className = 'message-time';
                messageTime.textContent = new Date().toLocaleTimeString([], {
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                messageContent.appendChild(messageText);
                messageContent.appendChild(messageTime);
                
                messageDiv.appendChild(avatar);
                messageDiv.appendChild(messageContent);
                
                messagesContainer.appendChild(messageDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
                
                this.messages.push({ content, sender, timestamp: new Date() });
            }

            showTypingIndicator() {
                const messagesContainer = document.getElementById('chatMessages');
                
                const typingDiv = document.createElement('div');
                typingDiv.className = 'message ai';
                typingDiv.id = 'typingIndicator';
                
                const avatar = document.createElement('div');
                avatar.className = 'message-avatar';
                avatar.textContent = 'AI';
                
                const typingIndicator = document.createElement('div');
                typingIndicator.className = 'typing-indicator';
                typingIndicator.style.display = 'flex';
                
                const typingDots = document.createElement('div');
                typingDots.className = 'typing-dots';
                for (let i = 0; i < 3; i++) {
                    const dot = document.createElement('div');
                    dot.className = 'typing-dot';
                    typingDots.appendChild(dot);
                }
                
                typingIndicator.appendChild(typingDots);
                typingDiv.appendChild(avatar);
                typingDiv.appendChild(typingIndicator);
                
                messagesContainer.appendChild(typingDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }

            hideTypingIndicator() {
                const typingIndicator = document.getElementById('typingIndicator');
                if (typingIndicator) {
                    typingIndicator.remove();
                }
            }

            showJobStatus(message) {
                const jobStatus = document.getElementById('jobStatus');
                jobStatus.textContent = message;
                jobStatus.classList.add('show');
            }

            hideJobStatus() {
                const jobStatus = document.getElementById('jobStatus');
                setTimeout(() => {
                    jobStatus.classList.remove('show');
                }, 1000);
            }
        }

        // Initialize the chat system
        document.addEventListener('DOMContentLoaded', () => {
            new AIChat();
        });

        // Add some demo functionality
        window.demoFunctions = {
            sendDemoMessage: () => {
                const input = document.getElementById('messageInput');
                const demoMessages = [
                    "How does your system handle scalability?",
                    "What's the architecture behind this chat system?",
                    "Can you explain the job processing workflow?",
                    "How do you ensure reliability and fault tolerance?"
                ];
                input.value = demoMessages[Math.floor(Math.random() * demoMessages.length)];
                document.getElementById('sendButton').click();
            }
        };
    </script>
</body>
</html>